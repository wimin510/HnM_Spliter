<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>HnM Spliter - 無賴帳本</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
  .card { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
  .row { display: flex; gap: 10px; margin-bottom: 10px; }
  input, select { flex: 1; padding: 8px; border-radius: 6px; border: 1px solid #ccc; }
  h2 { margin-top: 0; }
  .status { font-size: 20px; font-weight: bold; color: #d9534f; }
  table { width: 100%; border-collapse: collapse; }
  td, th { border-bottom: 1px solid #ccc; padding: 8px; }
</style>
</head>
<body>

<div class="card">
  <h2>目前欠款狀態</h2>
  <div id="statusDisplay" class="status">尚無資料</div>
</div>

<div class="card">
  <h2>新增分帳紀錄</h2>

  <div class="row">
    <select id="payer">
      <option value="YM">YM</option>
      <option value="OL">OL</option>
    </select>
    <input type="date" id="dateInput" />
  </div>

  <div class="row">
    <input type="number" id="totalAmount" placeholder="總金額 (TWD)" />
    <select id="currency">
      <option value="TWD">新台幣 (TWD)</option>
      <option value="JPY">日圓 (JPY)</option>
      <option value="USD">美元 (USD)</option>
    </select>
  </div>

  <div class="row">
    <input type="number" id="amountYM" placeholder="YM 負擔" />
    <input type="number" id="amountOL" placeholder="OL 負擔" />
  </div>

  <button id="addRecord">加入紀錄</button>
</div>

<div class="card">
  <h2>最近五筆紀錄</h2>
  <table>
    <thead><tr><th>日期</th><th>付款者</th><th>金額</th><th>幣別</th></tr></thead>
    <tbody id="recentRecords"></tbody>
  </table>
</div>

<script>
// 匯率自動抓取
async function fetchRates() {
  const res = await fetch("https://open.er-api.com/v6/latest/TWD");
  const data = await res.json();
  return data.rates;
}

let exchangeRates = {};
fetchRates().then(r => exchangeRates = r);

const totalInput = document.getElementById('totalAmount');
const ymInput = document.getElementById('amountYM');
const olInput = document.getElementById('amountOL');

// 其中一欄輸入後另一欄自動算
ymInput.addEventListener('input', () => {
  const total = parseFloat(totalInput.value) || 0;
  const ym = parseFloat(ymInput.value) || 0;
  olInput.value = total - ym;
});

olInput.addEventListener('input', () => {
  const total = parseFloat(totalInput.value) || 0;
  const ol = parseFloat(olInput.value) || 0;
  ymInput.value = total - ol;
});

// Firebase SDK from CDN
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-app.js";
import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-auth.js";
import { getFirestore } from "https://www.gstatic.com/firebasejs/10.12.3/firebase-firestore.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyCRHx0i02nojkN5-y5HxS3P3i1jA5SEy8E",
  authDomain: "hnm-spliter.firebaseapp.com",
  projectId: "hnm-spliter",
  storageBucket: "hnm-spliter.firebasestorage.app",
  messagingSenderId: "514297368344",
  appId: "1:514297368344:web:a9ee0cb370cddc1b6e986d",
  measurementId: "G-4DY12810X8"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// 匿名登入
async function anonymousLogin() {
  try {
    const userCredential = await signInAnonymously(auth);
    console.log("匿名登入成功 UID:", userCredential.user.uid);
  } catch (error) {
    console.error("匿名登入失敗:", error);
  }
}
anonymousLogin();

// TODO: 實作 firestore 儲存、讀取最近五筆、計算欠款
</script>

</body>
</html>
